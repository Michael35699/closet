var Closet=function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function e(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function r(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t}var o=function(t,e,r,n){var i=r<0?Math.min(0,t.length+r):r;return t.slice(0,i)+e+t.slice(n)},s=function(t,e,r){return t.length-(r-e)},a=function(){function t(t){this.rootTag=t,this.zoom=[]}return t.prototype.traverse=function(t){var e,n;void 0===t&&(t=this.zoom);var i=this.rootTag;try{for(var o=r(t),s=o.next();!s.done;s=o.next()){var a=s.value;if(!i.innerTags[a])return null;i=i.innerTags[a]}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i},t.prototype.exists=function(t){return void 0===t&&(t=this.zoom),!!this.traverse(t)},t.prototype.getTagInfo=function(t){return void 0===t&&(t=this.zoom),this.traverse(t)},t.prototype.getTag=function(t){void 0===t&&(t=this.zoom);var e=this.traverse(t);return e?e.data:null},t.prototype.getOffsets=function(t){void 0===t&&(t=this.zoom);var e=this.traverse(t);return e?[0,e.start]:null},t.prototype.setZoom=function(t){this.zoom=t},t}(),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(t,e){return t(e={exports:{}},e.exports),e.exports}var f=l((function(t){var e,r;e=u,r=function(){function t(e,r,n){return this.id=++t.highestId,this.name=e,this.symbols=r,this.postprocess=n,this}function e(t,e,r,n){this.rule=t,this.dot=e,this.reference=r,this.data=[],this.wantedBy=n,this.isComplete=this.dot===t.symbols.length}function r(t,e){this.grammar=t,this.index=e,this.states=[],this.wants={},this.scannable=[],this.completed={}}function n(t,e){this.rules=t,this.start=e||this.rules[0].name;var r=this.byName={};this.rules.forEach((function(t){r.hasOwnProperty(t.name)||(r[t.name]=[]),r[t.name].push(t)}))}function i(){this.reset("")}function o(t,e,o){if(t instanceof n){var s=t;o=e}else s=n.fromCompiled(t,e);for(var a in this.grammar=s,this.options={keepHistory:!1,lexer:s.lexer||new i},o||{})this.options[a]=o[a];this.lexer=this.options.lexer,this.lexerState=void 0;var u=new r(s,0);this.table=[u],u.wants[s.start]=[],u.predict(s.start),u.process(),this.current=0}return t.highestId=0,t.prototype.toString=function(t){function e(t){return t.literal?JSON.stringify(t.literal):t.type?"%"+t.type:t.toString()}var r=void 0===t?this.symbols.map(e).join(" "):this.symbols.slice(0,t).map(e).join(" ")+" ● "+this.symbols.slice(t).map(e).join(" ");return this.name+" → "+r},e.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},e.prototype.nextState=function(t){var r=new e(this.rule,this.dot+1,this.reference,this.wantedBy);return r.left=this,r.right=t,r.isComplete&&(r.data=r.build(),r.right=void 0),r},e.prototype.build=function(){var t=[],e=this;do{t.push(e.right.data),e=e.left}while(e.left);return t.reverse(),t},e.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))},r.prototype.process=function(t){for(var e=this.states,r=this.wants,n=this.completed,i=0;i<e.length;i++){var s=e[i];if(s.isComplete){if(s.finish(),s.data!==o.fail){for(var a=s.wantedBy,u=a.length;u--;){var l=a[u];this.complete(l,s)}if(s.reference===this.index){var f=s.rule.name;(this.completed[f]=this.completed[f]||[]).push(s)}}}else{if("string"!=typeof(f=s.rule.symbols[s.dot])){this.scannable.push(s);continue}if(r[f]){if(r[f].push(s),n.hasOwnProperty(f)){var h=n[f];for(u=0;u<h.length;u++){var c=h[u];this.complete(s,c)}}}else r[f]=[s],this.predict(f)}}},r.prototype.predict=function(t){for(var r=this.grammar.byName[t]||[],n=0;n<r.length;n++){var i=r[n],o=this.wants[t],s=new e(i,0,this.index,o);this.states.push(s)}},r.prototype.complete=function(t,e){var r=t.nextState(e);this.states.push(r)},n.fromCompiled=function(e,r){var i=e.Lexer;e.ParserStart&&(r=e.ParserStart,e=e.ParserRules);var o=new n(e=e.map((function(e){return new t(e.name,e.symbols,e.postprocess)})),r);return o.lexer=i,o},i.prototype.reset=function(t,e){this.buffer=t,this.index=0,this.line=e?e.line:1,this.lastLineBreak=e?-e.col:0},i.prototype.next=function(){if(this.index<this.buffer.length){var t=this.buffer[this.index++];return"\n"===t&&(this.line+=1,this.lastLineBreak=this.index),{value:t}}},i.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},i.prototype.formatError=function(t,e){var r=this.buffer;if("string"==typeof r){var n=r.indexOf("\n",this.index);-1===n&&(n=r.length);var i=r.substring(this.lastLineBreak,n),o=this.index-this.lastLineBreak;return e+=" at line "+this.line+" col "+o+":\n\n",e+="  "+i+"\n",e+="  "+Array(o).join(" ")+"^"}return e+" at index "+(this.index-1)},o.fail={},o.prototype.feed=function(t){var e,n=this.lexer;for(n.reset(t,this.lexerState);e=n.next();){var o=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var s=this.current+1,a=new r(this.grammar,s);this.table.push(a);for(var u=void 0!==e.text?e.text:e.value,l=n.constructor===i?e.value:e,f=o.scannable,h=f.length;h--;){var c=f[h],p=c.rule.symbols[c.dot];if(p.test?p.test(l):p.type?p.type===e.type:p.literal===u){var d=c.nextState({data:l,token:e,isToken:!0,reference:s-1});a.states.push(d)}}if(a.process(),0===a.states.length){var y=new Error(this.reportError(e));throw y.offset=this.current,y.token=e,y}this.options.keepHistory&&(o.lexerState=n.save()),this.current++}return o&&(this.lexerState=n.save()),this.results=this.finish(),this},o.prototype.reportError=function(t){var e=[],r=(t.type?t.type+" token: ":"")+JSON.stringify(void 0!==t.value?t.value:t);e.push(this.lexer.formatError(t,"Syntax error")),e.push("Unexpected "+r+". Instead, I was expecting to see one of the following:\n");var n=this.table.length-2;return this.table[n].states.filter((function(t){var e=t.rule.symbols[t.dot];return e&&"string"!=typeof e})).map((function(t){return this.buildFirstStateStack(t,[])||[t]}),this).forEach((function(t){var r=t[0],n=r.rule.symbols[r.dot],i=this.getSymbolDisplay(n);e.push("A "+i+" based on:"),this.displayStateStack(t,e)}),this),e.push(""),e.join("\n")},o.prototype.displayStateStack=function(t,e){for(var r,n=0,i=0;i<t.length;i++){var o=t[i],s=o.rule.toString(o.dot);s===r?n++:(n>0&&e.push("    ⬆ ︎"+n+" more lines identical to this"),n=0,e.push("    "+s)),r=s}},o.prototype.getSymbolDisplay=function(t){var e=typeof t;if("string"===e)return t;if("object"===e&&t.literal)return JSON.stringify(t.literal);if("object"===e&&t instanceof RegExp)return"character matching "+t;if("object"===e&&t.type)return t.type+" token";throw new Error("Unknown symbol type: "+t)},o.prototype.buildFirstStateStack=function(t,e){if(-1!==e.indexOf(t))return null;if(0===t.wantedBy.length)return[t];var r=t.wantedBy[0],n=[t].concat(e),i=this.buildFirstStateStack(r,n);return null===i?null:[t].concat(i)},o.prototype.save=function(){var t=this.table[this.current];return t.lexerState=this.lexerState,t},o.prototype.restore=function(t){var e=t.index;this.current=e,this.table[e]=t,this.table.splice(e+1),this.lexerState=t.lexerState,this.results=this.finish()},o.prototype.rewind=function(t){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[t])},o.prototype.finish=function(){var t=[],e=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(r){r.rule.name===e&&r.dot===r.rule.symbols.length&&0===r.reference&&r.data!==o.fail&&t.push(r)})),t.map((function(t){return t.data}))},{Parser:o,Grammar:n,Rule:t}},t.exports?t.exports=r():e.nearley=r()})),h=l((function(t){var e,r;e=u,r=function(){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,r="boolean"==typeof(new RegExp).sticky;function n(t){return t&&"[object RegExp]"===e.call(t)}function i(t){return t&&"object"==typeof t&&!n(t)&&!Array.isArray(t)}function o(t){return"("+t+")"}function s(t){return t.length?"(?:"+t.map((function(t){return"(?:"+t+")"})).join("|")+")":"(?!)"}function a(t){if("string"==typeof t)return"(?:"+t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(n(t)){if(t.ignoreCase)throw new Error("RegExp /i flag not allowed");if(t.global)throw new Error("RegExp /g flag is implied");if(t.sticky)throw new Error("RegExp /y flag is implied");if(t.multiline)throw new Error("RegExp /m flag is implied");return t.source}throw new Error("Not a pattern: "+t)}function u(e,r){if(i(r)||(r={match:r}),r.include)throw new Error("Matching rules cannot also include states");var o={defaultType:e,lineBreaks:!!r.error||!!r.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var s in r)t.call(r,s)&&(o[s]=r[s]);if("string"==typeof o.type&&e!==o.type)throw new Error("Type transform cannot be a string (type '"+o.type+"' for token '"+e+"')");var a=o.match;return o.match=Array.isArray(a)?a:a?[a]:[],o.match.sort((function(t,e){return n(t)&&n(e)?0:n(e)?-1:n(t)?1:e.length-t.length})),o}function l(t){return Array.isArray(t)?function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];if(n.include)for(var i=[].concat(n.include),o=0;o<i.length;o++)e.push({include:i[o]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));e.push(u(n.type,n))}}return e}(t):function(t){for(var e=Object.getOwnPropertyNames(t),r=[],n=0;n<e.length;n++){var o=e[n],s=t[o],a=[].concat(s);if("include"!==o){var l=[];a.forEach((function(t){i(t)?(l.length&&r.push(u(o,l)),r.push(u(o,t)),l=[]):l.push(t)})),l.length&&r.push(u(o,l))}else for(var f=0;f<a.length;f++)r.push({include:a[f]})}return r}(t)}var f=u("error",{lineBreaks:!0,shouldThrow:!0});function h(t,e){for(var i=null,u=Object.create(null),l=!0,h=null,c=[],p=[],d=0;d<t.length;d++)t[d].fallback&&(l=!1);for(d=0;d<t.length;d++){var y=t[d];if(y.include)throw new Error("Inheritance is not allowed in stateless lexers");if(y.error||y.fallback){if(i)throw!y.fallback==!i.fallback?new Error("Multiple "+(y.fallback?"fallback":"error")+" rules not allowed (for token '"+y.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+y.defaultType+"')");i=y}var v=y.match.slice();if(l)for(;v.length&&"string"==typeof v[0]&&1===v[0].length;)u[v.shift().charCodeAt(0)]=y;if(y.pop||y.push||y.next){if(!e)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+y.defaultType+"')");if(y.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+y.defaultType+"')")}if(0!==v.length){l=!1,c.push(y);for(var g=0;g<v.length;g++){var m=v[g];if(n(m))if(null===h)h=m.unicode;else if(h!==m.unicode&&!1===y.fallback)throw new Error("If one rule is /u then all must be")}var b=s(v.map(a)),x=new RegExp(b);if(x.test(""))throw new Error("RegExp matches empty string: "+x);if(new RegExp("|"+b).exec("").length-1>0)throw new Error("RegExp has capture groups: "+x+"\nUse (?: … ) instead");if(!y.lineBreaks&&x.test("\n"))throw new Error("Rule should declare lineBreaks: "+x);p.push(o(b))}}var w=i&&i.fallback,k=r&&!w?"ym":"gm",S=r||w?"":"|";return!0===h&&(k+="u"),{regexp:new RegExp(s(p)+S,k),groups:c,fast:u,error:i||f}}function c(t,e,r){var n=t&&(t.push||t.next);if(n&&!r[n])throw new Error("Missing state '"+n+"' (in token '"+t.defaultType+"' of state '"+e+"')");if(t&&t.pop&&1!=+t.pop)throw new Error("pop must be 1 (in token '"+t.defaultType+"' of state '"+e+"')")}var p=function(t,e){this.startState=e,this.states=t,this.buffer="",this.stack=[],this.reset()};p.prototype.reset=function(t,e){return this.buffer=t||"",this.index=0,this.line=e?e.line:1,this.col=e?e.col:1,this.queuedToken=e?e.queuedToken:null,this.queuedThrow=e?e.queuedThrow:null,this.setState(e?e.state:this.startState),this.stack=e&&e.stack?e.stack.slice():[],this},p.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},p.prototype.setState=function(t){if(t&&this.state!==t){this.state=t;var e=this.states[t];this.groups=e.groups,this.error=e.error,this.re=e.regexp,this.fast=e.fast}},p.prototype.popState=function(){this.setState(this.stack.pop())},p.prototype.pushState=function(t){this.stack.push(this.state),this.setState(t)};var d=r?function(t,e){return t.exec(e)}:function(t,e){var r=t.exec(e);return 0===r[0].length?null:r};function y(){return this.value}if(p.prototype._getGroup=function(t){for(var e=this.groups.length,r=0;r<e;r++)if(void 0!==t[r+1])return this.groups[r];throw new Error("Cannot find token type for matched text")},p.prototype.next=function(){var t=this.index;if(this.queuedGroup){var e=this._token(this.queuedGroup,this.queuedText,t);return this.queuedGroup=null,this.queuedText="",e}var r=this.buffer;if(t!==r.length){if(s=this.fast[r.charCodeAt(t)])return this._token(s,r.charAt(t),t);var n=this.re;n.lastIndex=t;var i=d(n,r),o=this.error;if(null==i)return this._token(o,r.slice(t,r.length),t);var s=this._getGroup(i),a=i[0];return o.fallback&&i.index!==t?(this.queuedGroup=s,this.queuedText=a,this._token(o,r.slice(t,i.index),t)):this._token(s,a,t)}},p.prototype._token=function(t,e,r){var n=0;if(t.lineBreaks){var i=/\n/g,o=1;if("\n"===e)n=1;else for(;i.exec(e);)n++,o=i.lastIndex}var s={type:"function"==typeof t.type&&t.type(e)||t.defaultType,value:"function"==typeof t.value?t.value(e):e,text:e,toString:y,offset:r,lineBreaks:n,line:this.line,col:this.col},a=e.length;if(this.index+=a,this.line+=n,0!==n?this.col=a-o+1:this.col+=a,t.shouldThrow)throw new Error(this.formatError(s,"invalid syntax"));return t.pop?this.popState():t.push?this.pushState(t.push):t.next&&this.setState(t.next),s},"undefined"!=typeof Symbol&&Symbol.iterator){var v=function(t){this.lexer=t};v.prototype.next=function(){var t=this.lexer.next();return{value:t,done:!t}},v.prototype[Symbol.iterator]=function(){return this},p.prototype[Symbol.iterator]=function(){return new v(this)}}return p.prototype.formatError=function(t,e){if(null==t){var r=this.buffer.slice(this.index);t={text:r,offset:this.index,lineBreaks:-1===r.indexOf("\n")?0:1,line:this.line,col:this.col}}var n=Math.max(0,t.offset-t.col+1),i=t.lineBreaks?t.text.indexOf("\n"):t.text.length,o=this.buffer.substring(n,t.offset+i);return e+=" at line "+t.line+" col "+t.col+":\n\n",e+="  "+o+"\n",e+="  "+Array(t.col).join(" ")+"^"},p.prototype.clone=function(){return new p(this.states,this.state)},p.prototype.has=function(t){return!0},{compile:function(t){var e=h(l(t));return new p({start:e},"start")},states:function(t,e){var r=t.$all?l(t.$all):[];delete t.$all;var n=Object.getOwnPropertyNames(t);e||(e=n[0]);for(var i=Object.create(null),o=0;o<n.length;o++)i[b=n[o]]=l(t[b]).concat(r);for(o=0;o<n.length;o++)for(var s=i[b=n[o]],a=Object.create(null),u=0;u<s.length;u++){var f=s[u];if(f.include){var d=[u,1];if(f.include!==b&&!a[f.include]){a[f.include]=!0;var y=i[f.include];if(!y)throw new Error("Cannot include nonexistent state '"+f.include+"' (in state '"+b+"')");for(var v=0;v<y.length;v++){var g=y[v];-1===s.indexOf(g)&&d.push(g)}}s.splice.apply(s,d),u--}}var m=Object.create(null);for(o=0;o<n.length;o++){var b;m[b=n[o]]=h(i[b],!0)}for(o=0;o<n.length;o++){var x=n[o],w=m[x],k=w.groups;for(u=0;u<k.length;u++)c(k[u],x,m);var S=Object.getOwnPropertyNames(w.fast);for(u=0;u<S.length;u++)c(w.fast[S[u]],x,m)}return new p(m,e)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(t){for(var e=Object.create(null),r=Object.create(null),n=Object.getOwnPropertyNames(t),i=0;i<n.length;i++){var o=n[i],s=t[o];(Array.isArray(s)?s:[s]).forEach((function(t){if((r[t.length]=r[t.length]||[]).push(t),"string"!=typeof t)throw new Error("keyword must be string (in keyword '"+o+"')");e[t]=o}))}function a(t){return JSON.stringify(t)}var u="";for(var l in u+="switch (value.length) {\n",r){var f=r[l];u+="case "+l+":\n",u+="switch (value) {\n",f.forEach((function(t){var r=e[t];u+="case "+a(t)+": return "+a(r)+"\n"})),u+="}\n"}return u+="}\n",Function("value",u)}}},t.exports?t.exports=r():e.moo=r()})).states({main:{tagopen:{match:"[[",push:"key"},EOF:{match:/\$$/u},text:{match:/[\s\S]+?(?=\[\[|\$$)/u,lineBreaks:!0}},key:{keyname:{match:/[a-zA-Z]+\d*/u},sep:{match:"::",next:"intag"},tagclose:{match:"]]",pop:1}},intag:{tagopen:{match:"[[",push:"key"},tagclose:{match:"]]",pop:1},valuestext:{match:/[\s\S]+?(?=\[\[|\]\])/u,lineBreaks:!0}}}),c=function(){function t(t,e,r,n,i,o,s){this.fullKey=t,this.key=e,this.num=r,this.valuesRaw=n,this.values=function(t){return null===t?[]:t.split("::").map((function(t){return t.split("||")}))}(n),this.fullOccur=i,this.occur=o,this.path=s}return t.prototype.shadowValuesRaw=function(e){return new t(this.fullKey,this.key,this.num,e,this.fullOccur,this.occur,this.path)},t.prototype.getDefaultRepresentation=function(){return null===this.valuesRaw?"[["+this.fullKey+"]]":"[["+this.fullKey+"::"+this.valuesRaw+"]]"},t.prototype.getRawRepresentation=function(){var t;return null!==(t=this.valuesRaw)&&void 0!==t?t:""},t.prototype.getFilterKey=function(){return this.key},t}(),p=function(t,e,r,n,i){void 0===i&&(i=!1),this.start=t,this.end=e,this.data=r,this.innerTags=n,this.naked=i},d=/^([^0-9]+)([0-9]*)$/u,y=function(){function t(){this.tagCounter=new Map,this.tagPathStack=[],this.tagPathNext=0}return t.prototype.getAndInc=function(t){var e=this.tagCounter.has(t)?this.tagCounter.get(t)+1:0;return this.tagCounter.set(t,e),e},t.prototype.signalTagOpen=function(){this.tagPathStack.push(this.tagPathNext),this.tagPathNext=0},t.prototype.build=function(t,e){var r=t.match(d),n=r[1],o=0===r[2].length?null:Number(r[2]),s=this.getAndInc(t),a=t===n?s:this.getAndInc(n),u=new c(t,n,o,e,s,a,i(this.tagPathStack));return this.tagPathNext=this.tagPathStack.pop()+1,u},t.prototype.reset=function(){this.tagCounter.clear(),this.tagPathStack.length=0,this.tagPathNext=0},t}(),v=function(){function t(){this.fixedLeftOffset=0}return t.prototype.addToLeftOffset=function(t){this.fixedLeftOffset+=t},t.prototype.resetLeftOffset=function(){var t=this.fixedLeftOffset;return this.fixedLeftOffset=0,t},t.prototype.build=function(t,e,r,n,i){return void 0===i&&(i=!1),new p(t+this.fixedLeftOffset,e+this.fixedLeftOffset,r,n,i)},t}();function g(t){return t[0]}var m=function(t){return n(t,1)[0].map((function(t){return t.value})).join("")},b=new y,x=new v,w={Lexer:h,ParserRules:[{name:"start",symbols:["content",h.has("EOF")?{type:"EOF"}:EOF],postprocess:function(t){var e=n(t,2),r=n(e[0],2),i=r[0],o=r[1],s=e[1];return x.build(0,s.offset,b.build("base",i),o,!0)}},{name:"content$ebnf$1",symbols:[]},{name:"content$ebnf$1$subexpression$1",symbols:["tag","_"]},{name:"content$ebnf$1",symbols:["content$ebnf$1","content$ebnf$1$subexpression$1"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"content",symbols:["_","content$ebnf$1"],postprocess:function(t){var e=n(t,2),r=e[0],i=e[1];return[r+i.map((function(t){var e=n(t,2),r=e[0],i=e[1];return g(r).join("")+i})).join(""),i.map(g).map((function(t){return t[1]}))]}},{name:"tag",symbols:["tagopen","inner",h.has("tagclose")?{type:"tagclose"}:tagclose],postprocess:function(t){var e=n(t,3),r=e[0],i=n(e[1],3),o=i[0],s=i[1],a=i[2],u=e[2],l="string"==typeof s;return[["[[",l?o+"::"+s:o,"]]"],x.build(r,u.offset+"]]".length,b.build(o,l?s:null),a.map((function(t){return t[1]})))]}},{name:"tagopen",symbols:[h.has("tagopen")?{type:"tagopen"}:tagopen],postprocess:function(t){var e=n(t,1)[0];return b.signalTagOpen(),e.offset+e.value.length-"[[".length}},{name:"inner$ebnf$1$subexpression$1$ebnf$1",symbols:[]},{name:"inner$ebnf$1$subexpression$1$ebnf$1$subexpression$1",symbols:["tag","_values"]},{name:"inner$ebnf$1$subexpression$1$ebnf$1",symbols:["inner$ebnf$1$subexpression$1$ebnf$1","inner$ebnf$1$subexpression$1$ebnf$1$subexpression$1"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"inner$ebnf$1$subexpression$1",symbols:[h.has("sep")?{type:"sep"}:sep,"_values","inner$ebnf$1$subexpression$1$ebnf$1"]},{name:"inner$ebnf$1",symbols:["inner$ebnf$1$subexpression$1"],postprocess:g},{name:"inner$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"inner",symbols:[h.has("keyname")?{type:"keyname"}:keyname,"inner$ebnf$1"],postprocess:function(t){var e=n(t,2),r=e[0],i=e[1];return[r.value,i?i[1]+i[2].map((function(t){var e=n(t,2),r=e[0],i=e[1];return g(r).join("")+i})).join(""):null,i?i[2].map(g):[]]}},{name:"_values$ebnf$1",symbols:[]},{name:"_values$ebnf$1",symbols:["_values$ebnf$1",h.has("valuestext")?{type:"valuestext"}:valuestext],postprocess:function(t){return t[0].concat([t[1]])}},{name:"_values",symbols:["_values$ebnf$1"],postprocess:m},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1",h.has("text")?{type:"text"}:text],postprocess:function(t){return t[0].concat([t[1]])}},{name:"_",symbols:["_$ebnf$1"],postprocess:m}],ParserStart:"start"},k=function(t){return x.build(0,t.length,b.build("base",t),[],!0)},S=function(t){var e=new f.Parser(f.Grammar.fromCompiled(w)),r=null;try{r=e.feed(t+"$").results}catch(e){r=[k(t)]}return r.length,r[0]},$=function(t){var e=S(t);return b.reset(),e},E=function(t){var e,n,i=[];try{for(var o=r(t),s=o.next();!s.done;s=o.next()){var a=s.value;b.signalTagOpen();var u=S(a);i.push(u),x.addToLeftOffset(a.length)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}var l=x.resetLeftOffset(),f=x.build(0,l,b.build("base",t.join("")),i,!0);return b.reset(),f},O=function(t,e){for(var r=t,i=!1,o=0;o<50&&!i;o++){var s=$(r),u=new a(s),l=n(T(r,s,1,e.filterProcessor({iteration:{index:o},template:u,baseDepth:1})),4);r=l[0],i=l[2],e.executeDeferred()}return r},_=function(t,e){var i,o,s=[];try{for(var a=r(e),u=a.next();!u.done;u=a.next()){var l=n(u.value,2),f=l[0],h=l[1];s.push(t.slice(f,h))}}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return s},N=function(t,e){for(var r=t,i=!1,o=0;o<50&&!i;o++){var s=E(r),u=new a(s),l=n(T(r.join(""),s,2,e.filterProcessor({iteration:{index:o},template:u,baseDepth:2})),4),f=l[0],h=l[2],c=l[3];r=_(f,c),i=h,e.executeDeferred()}return r},T=function(t,e,r,i){var a=[],u=function(t,e){var l=n(t,3),f=l[0],h=l[1],c=l[2];h.push(h[h.length-1]);var p=n(e.innerTags.reduce(u,[f,h,!0]),3),d=p[0],y=p[1],v=p[2];y.push(y.pop()-y[y.length-1]);var g=y.pop(),m=y.pop(),b=n(function(t,e,r,n){return[t+r,e+r+n]}(e.start,e.end,m,g),2),x=b[0],w=b[1],k=null,S=e.data.path.length+1;S<=r?(k=d.slice(x,w),S===r&&a.push([x,w])):k=null===e.data.valuesRaw?null:d.slice(x+("[[".length+e.data.fullKey.length+"::".length),w-"]]".length);var $=e.data.shadowValuesRaw(k),E=i($,{ready:v,depth:S-r}),O=n(null===E.result?[d,0]:function(t,e,r,n){return[o(t,e,r,n),s(e,r,n)]}(d,E.result,x,w),2),_=O[0],N=g+m+O[1];return y.push(N),[_,y,c&&E.ready]},l=n(u([t,[0,0],!0],e),3);return[l[0],l[1],l[2],a]},j=function(){function t(t){this.storage=t}return t.prototype.set=function(t,e){this.storage.set(t,e)},t.prototype.has=function(t){return this.storage.has(t)},t.prototype.get=function(t,e){return void 0===e&&(e=null),this.has(t)?this.storage.get(t):e},t.prototype.fold=function(t,e,r){var n=e(this.get(t,r));return this.set(t,n),n},t.prototype.over=function(t,e,r){this.has(t)?e(this.get(t,r)):(e(r),this.set(t,r))},t.prototype.delete=function(t){this.storage.delete(t)},t.prototype.clear=function(){this.storage.clear()},t}(),I=function(t){return{result:t,ready:!0}},R=function(t,e){return{result:t,ready:e}},P=function(t){return function(e,r){var n,i=t(e,r);switch(typeof i){case"string":return I(i);case"object":return{result:i.result,ready:null===(n=i.ready)||void 0===n||n};default:return{result:null,ready:!1}}}},z=function(t,e){return R(t.getRawRepresentation(),e.ready)},A=function(t){return I(t.getRawRepresentation())},C=function(t,e){return R(t.getDefaultRepresentation(),e.ready)},L=function(){function t(){this.filters=new Map}return t.prototype.register=function(t,e){this.filters.set(t,e)},t.prototype.has=function(t){return"raw"===t||"base"===t||this.filters.has(t)},t.prototype.get=function(t){return"base"===t?z:"raw"===t?A:this.filters.has(t)?P(this.filters.get(t)):null},t.prototype.getOrDefault=function(t){var e=this.get(t);return e||C},t.prototype.unregisterFilter=function(t){this.filters.delete(t)},t.prototype.clearFilters=function(){this.filters.clear()},t.prototype.execute=function(t,e){return P(this.getOrDefault(t.getFilterKey()))(t,e)},t}(),M=function(t){return(t+1>>>1)-1},D=function(t){return 1+(t<<1)},B=function(t){return t+1<<1},F=function(){function t(t){void 0===t&&(t=function(t,e){return t>e}),this._heap=[],this._comparator=t}return t.prototype.greater=function(t,e){return this._comparator(this._heap[t],this._heap[e])},t.prototype.swap=function(t,e){var r;r=n([this._heap[e],this._heap[t]],2),this._heap[t]=r[0],this._heap[e]=r[1]},t.prototype.siftUp=function(){for(var t=this.size()-1;t>0&&this.greater(t,M(t));)this.swap(t,M(t)),t=M(t)},t.prototype.siftDown=function(){for(var t=0;D(t)<this.size()&&this.greater(D(t),t)||B(t)<this.size()&&this.greater(B(t),t);){var e=B(t)<this.size()&&this.greater(B(t),D(t))?B(t):D(t);this.swap(t,e),t=e}},t.prototype.size=function(){return this._heap.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.peek=function(){return this._heap[0]},t.prototype.push=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.forEach((function(e){t._heap.push(e),t.siftUp()})),this.size()},t.prototype.pop=function(){var t=this.peek(),e=this.size()-1;return e>0&&this.swap(0,e),this._heap.pop(),this.siftDown(),t},t.prototype.generate=function(){var t;return e(this,(function(e){switch(e.label){case 0:t=this.pop(),e.label=1;case 1:return t?[4,t]:[3,3];case 2:return e.sent(),t=this.pop(),[3,1];case 3:return[2,null]}}))},t}(),q={priority:50,persistent:!1},H=function(t,e){return t.priority<e.priority},G=function(){function t(){this._deferred=new Map,this._blocked=new Set}return t.prototype.register=function(t,e,r){void 0===r&&(r=q),this._deferred.set(t,{keyword:t,procedure:e,priority:r.priority,persistent:r.persistent})},t.prototype.registerIfNotExists=function(t,e,r){void 0===r&&(r=q),this.isRegistered(t)||this.register(t,e,r)},t.prototype.unregister=function(t){this._deferred.delete(t)},t.prototype.isRegistered=function(t){return this._deferred.has(t)},t.prototype.block=function(t){this._blocked.add(t)},t.prototype.unblock=function(t){this._blocked.delete(t)},t.prototype.isBlocked=function(t){return this._blocked.has(t)},t.prototype.clear=function(){this._deferred.clear(),this._blocked.clear()},t.prototype.executeEach=function(){for(var t,e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=new F(H);s.push.apply(s,i(this._deferred.values()));try{for(var a=r(s.generate()),u=a.next();!u.done;u=a.next()){var l=u.value;this.isBlocked(l.keyword)||l.procedure.apply(l,i([l.keyword],n)),l.persistent||this.unregister(l.keyword)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}this._blocked.clear()},t}(),K=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=new Map),this.filters=new L,this.deferred=new G,this.preset=t,this.cache=new j(new Map),this.memory=new j(e)}return t.prototype.filterProcessor=function(t){var e=this;return function(r,n){var i=Object.assign(e.preset,t,n,{cache:e.cache,memory:e.memory,filters:e.filters,deferred:e.deferred});return e.filters.execute(r,i)}},t.prototype.executeDeferred=function(){this.deferred.executeEach()},t.prototype.clearMemory=function(){this.memory.clear()},t.prototype.reset=function(){this.cache.clear(),this.deferred.clear()},t.prototype.addRecipe=function(t){t(this.filters)},t}(),J=function(t){return t},U=function(t,e){var n,i,o,s,a=[];try{for(var u=r(e),l=u.next();!l.done;l=u.next()){var f=t[d=l.value];f&&a.push(f)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(e.length<t.length){var h=Array.from(new Array(t.length-e.length),(function(t,r){return r+e.length}));try{for(var c=r(h),p=c.next();!p.done;p=c.next()){var d=p.value;a.push(t[d])}}catch(t){o={error:t}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}}return a},V=function(t,e){if(t.length>=e)return t;var r=Array.from(new Array(e-t.length),(function(e,r){return r+t.length})),n=i(t);return r.forEach((function(t){return n.splice(Math.floor(Math.random()*(n.length+1)),0,t)})),n},X=function(t){return t.map((function(t){return Number(t)})).filter((function(t){return!isNaN(t)}))},Z=function(t,e){return e.includes(",")?e.split(","):t[0]},Q=function(){function t(t){var e=void 0===t?{}:t,r=e.separator,n=void 0===r?", ":r,i=e.separatorOuter,o=void 0===i?"; ":i,s=e.mapper,a=void 0===s?J:s,u=e.mapperOuter,l=void 0===u?J:u,f=e.postprocess,h=void 0===f?J:f;this.separator=n,this.separatorOuter=o,this.mapper=a,this.mapperOuter=l,this.postprocess=h}return t.prototype.stylize=function(t){var e=this;return this.postprocess(t.map((function(t){return t.map(e.mapper).join(e.separator)})).map(this.mapperOuter).join(this.separatorOuter))},t.prototype.stylizeInner=function(t){return this.mapperOuter(t.map(this.mapper).join(this.separator))},t}(),W=/%(\d*)/u,Y={shuffling:function(t,e){return void 0===e&&(e=new Q),function(r){r.register(t,(function(t,r){var n=t.fullKey,i=t.fullOccur,o=t.num,s=t.values,a=r.cache,u=r.memory,l=r.deferred,f=r.ready,h=n+":"+i,c=n+":waitingSet",p=h+":apply";if(a.get(p,!1)){if(a.get(c,new Set).size>0)return;for(var d=[],y=a.get(n,[]),v=0;v<s[0].length;v++)d.push(y.shift());return e.stylizeInner(d)}if(f){if(!o)return e.stylizeInner(function(t){for(var e=t.slice(0),r=t.length,n=null,i=null;0!==r;)i=Math.floor(Math.random()*r),n=e[r-=1],e[r]=e[i],e[i]=n;return e}(s[0]));a.fold(n,(function(t){return t.concat(s[0])}),[]),l.registerIfNotExists(p,(function(){a.set(p,!0),a.over(c,(function(t){return t.delete(h)}),new Set)}));var g=n+":mix";l.registerIfNotExists(g,(function(){a.get(c,new Set).size>0||a.fold(n,(function(t){var e=u.fold(n,(function(t){return V(t,a.get(n,[]).length)}),[]);return U(t,e)}),[])}))}else a.over(c,(function(t){return t.add(h)}),new Set)}))}},ordering:function(t,e){return function(n){n.register(t,(function(t,n){var i=t.key,o=t.fullOccur,s=t.values,a=t.valuesRaw,u=n.deferred,l=n.cache,f=i+":ord:occupied",h=X(Z(s,a)).filter((function(t){return!l.get(f,[]).includes(t)}));l.fold(f,(function(t){return t.concat(h)}),[]);var c=new Set(h.map((function(t){return""+e+t}))),p=i+":"+o+":ord";return u.register(p,(function(){var t,e,n=[],i=function(t){if(u.block(t+":mix"),0!==l.get(t+":waitingSet",new Set).size)return"continue";var e=l.get(t,[]),r=V(l.get(p,[]),e.length);l.fold(t,(function(t){return U(t,r)}),[]),n.push(t),l.set(p,r)};try{for(var o=r(c),s=o.next();!s.done;s=o.next()){i(s.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}n.forEach((function(t){return c.delete(t)})),0===c.size&&u.unregister(p)}),{priority:35,persistent:!0}),""}))}},cloze:function(t){return function(e){e.register(t,(function(t,e){}))}},random:function(t){return function(e){e.register(t,(function(t){t.num;var e=t.values,r=t.valuesRaw,i=n(X(Z(e,r)),3),o=i[0],s=void 0===o?1:o,a=i[1],u=void 0===a?null:a,l=i[2],f=void 0===l?1:l;return String(s>u?0:(s+Math.floor(Math.random()*u-s))*f)}))}},multipleChoice:function(t){return function(e){e.register(t,(function(t,e){}))}},debug:function(t){t.register("tagpath",(function(t){return t.path.join(":")})),t.register("never",(function(){})),t.register("empty",(function(){return""})),t.register("key",(function(t){return t.key})),t.register("memorytest",(function(t,e){var r=e.memory;return String(r.fold("base:memorytest",(function(t){return++t}),0))}))},meta:function(t){t.register("def",(function(t,e){var r=t.values,n=e.filters,i=r;return n.register(r[0][0],(function(t){var e=t.values;return{result:"[["+i.slice(1).map((function(t){return t.map((function(t){var r=t.match(W);if(r){var n=0===r[1].length?0:Number(r[1]);return e[n]?e[n].join("||"):""}return t})).join("||")})).join("::")+"]]",ready:!1}})),{result:"",ready:!1}}))},stylizing:function(t,e){return void 0===e&&(e=new Q),function(r){r.register(t,(function(t){var r=t.values;return e.stylize(r)}))}}},tt={tagsFull:"{{Tags}}",card:"{{Card}}",tags:"{{Tags}}".split(" ")},et=Object.freeze({__proto__:null,preset:tt,memorySwitch:function(t){var e=null;return{switchTo:function(r){t.getItem(r)||t.setItem(r,new Map),e=t.getItem(r)},fallback:function(){e=new Map},has:function(t){return e.has(t)},get:function(t){return e.get(t)},set:function(t,r){return e.set(t,r)},delete:function(t){return e.delete(t)},clear:function(){return e.clear()}}}}),rt=function(t,e){return t<0?e+t:t},nt=function(t){if("string"==typeof t)return t;switch(t.nodeType){case Node.TEXT_NODE:return t.textContent;case Node.ELEMENT_NODE:return t.innerHTML;case ot.CHILD_NODE_SPAN:return t.spanAsStrings().join("");default:return""}},it=function(t,e){if("string"!=typeof t)switch(t.nodeType){case Node.TEXT_NODE:var r=t,n=document.createElement("div");r.parentElement.insertBefore(n,r),r.parentElement.removeChild(r),n.outerHTML=e;break;case Node.ELEMENT_NODE:t.innerHTML=e;break;case ot.CHILD_NODE_SPAN:t.replaceSpan(e)}},ot=function(){function t(e,r,n){var i,o,s,a,u,l;this.nodeType=t.CHILD_NODE_SPAN,this.parent=e,this.childNodes=Array.from(this.parent.childNodes),this.max=e.childNodes.length-1,this.fromIndex="index"===r.type?this.from(r.value,null!==(i=r.exclusive)&&void 0!==i&&i):"node"===r.type?this.fromNode(r.value,null!==(o=r.exclusive)&&void 0!==o&&o):this.fromPredicate(r.value,null!==(s=r.exclusive)&&void 0!==s&&s),this.toIndex="index"===n.type?this.to(n.value,null!==(a=n.exclusive)&&void 0!==a&&a):"node"===n.type?this.toNode(n.value,null!==(u=n.exclusive)&&void 0!==u&&u):this.toPredicate(n.value,null!==(l=n.exclusive)&&void 0!==l&&l)}return t.prototype.fromSafe=function(t){return t<0||t>this.max?this.max:t},t.prototype.from=function(t,e){var r=rt(t,this.max)+(e?1:0);return this.fromSafe(r)},t.prototype.fromPredicate=function(t,e){var r=this.childNodes.findIndex(t)+(e?1:0);return this.fromSafe(r)},t.prototype.fromNode=function(t,e){var r=this.childNodes.findIndex((function(e){return e===t}))+(e?1:0);return this.fromSafe(r)},t.prototype.toSafe=function(t){return t<0||t>this.max?0:t},t.prototype.to=function(t,e){var r=rt(t,this.max)-(e?1:0);return this.toSafe(r)},t.prototype.toPredicate=function(t,e){var r=this.childNodes.findIndex(t)-(e?1:0);return this.toSafe(r)},t.prototype.toNode=function(t,e){var r=this.childNodes.findIndex((function(e){return e===t}))-(e?1:0);return this.toSafe(r)},t.prototype.isValid=function(){return this.fromIndex<=this.toIndex},t.prototype.length=function(){return Math.min(0,this.toIndex-this.fromIndex)},t.prototype.span=function(){return this.isValid()?this.childNodes.slice(this.fromIndex,this.toIndex):[]},t.prototype.spanAsStrings=function(){return this.span().map(nt)},t.prototype.replaceSpan=function(t){var e,n;if(this.isValid()){var i=document.createElement("div"),o=this.parent.childNodes.length;this.parent.insertBefore(i,this.parent.childNodes[this.fromIndex]);try{for(var s=r(this.span()),a=s.next();!a.done;a=s.next()){var u=a.value;this.parent.removeChild(u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}i.outerHTML=t,this.childNodes=Array.from(this.parent.childNodes),this.max=this.childNodes.length,this.toIndex=this.toIndex+(this.max-o)}},t.CHILD_NODE_SPAN=3353,t}(),st=Object.freeze({__proto__:null,ChildNodeSpan:ot,renderTemplateFromNode:function(t,e){var r=O(nt(t),e);it(t,r)},renderTemplateFromNodes:function(t,e){var r=N(t.map(nt),e);t.forEach((function(t,e){return it(t,r[e])}))}});return t.FilterManager=K,t.Stylizer=Q,t.anki=et,t.browser=st,t.recipes=Y,t.renderDisjointTemplate=N,t.renderTemplate=O,t}({});
