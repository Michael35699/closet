var Closet=function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};function r(t,e){var r,n,u,o,i={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(u=2&o[0]?n.return:o[0]?n.throw||((u=n.return)&&u.call(n),0):n.next)&&!(u=u.call(n,o[1])).done)return u;switch(n=0,u&&(o=[2&o[0],u.value]),o[0]){case 0:case 1:u=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(u=i.trys,(u=u.length>0&&u[u.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!u||o[1]>u[0]&&o[1]<u[3])){i.label=o[1];break}if(6===o[0]&&i.label<u[1]){i.label=u[1],u=o;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(o);break}u[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],n=0}finally{r=u=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function n(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,u,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(t){u={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(u)throw u.error}}return i}function o(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}var i=function(t,e,r,n){var u=r<0?Math.min(0,t.length+r):r;return t.slice(0,u)+e+t.slice(n)},s=function(t,e,r){return t.length-(r-e)},a=function(){function t(t){this.rootTag=t,this.zoom=[]}return t.prototype.traverse=function(t){var e,r;void 0===t&&(t=this.zoom);var u=this.rootTag;try{for(var o=n(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(!u.innerTags[s])return null;u=u.innerTags[s]}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return u},t.prototype.exists=function(t){return void 0===t&&(t=this.zoom),!!this.traverse(t)},t.prototype.getTagInfo=function(t){return void 0===t&&(t=this.zoom),this.traverse(t)},t.prototype.getTag=function(t){void 0===t&&(t=this.zoom);var e=this.traverse(t);return e?e.data:null},t.prototype.getOffsets=function(t){void 0===t&&(t=this.zoom);var e=this.traverse(t);return e?[0,e.start]:null},t.prototype.setZoom=function(t){this.zoom=t},t}(),l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(t,e){return t(e={exports:{}},e.exports),e.exports}var f=c((function(t){var e,r;e=l,r=function(){function t(e,r,n){return this.id=++t.highestId,this.name=e,this.symbols=r,this.postprocess=n,this}function e(t,e,r,n){this.rule=t,this.dot=e,this.reference=r,this.data=[],this.wantedBy=n,this.isComplete=this.dot===t.symbols.length}function r(t,e){this.grammar=t,this.index=e,this.states=[],this.wants={},this.scannable=[],this.completed={}}function n(t,e){this.rules=t,this.start=e||this.rules[0].name;var r=this.byName={};this.rules.forEach((function(t){r.hasOwnProperty(t.name)||(r[t.name]=[]),r[t.name].push(t)}))}function u(){this.reset("")}function o(t,e,o){if(t instanceof n){var i=t;o=e}else i=n.fromCompiled(t,e);for(var s in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new u},o||{})this.options[s]=o[s];this.lexer=this.options.lexer,this.lexerState=void 0;var a=new r(i,0);this.table=[a],a.wants[i.start]=[],a.predict(i.start),a.process(),this.current=0}return t.highestId=0,t.prototype.toString=function(t){function e(t){return t.literal?JSON.stringify(t.literal):t.type?"%"+t.type:t.toString()}var r=void 0===t?this.symbols.map(e).join(" "):this.symbols.slice(0,t).map(e).join(" ")+" ● "+this.symbols.slice(t).map(e).join(" ");return this.name+" → "+r},e.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},e.prototype.nextState=function(t){var r=new e(this.rule,this.dot+1,this.reference,this.wantedBy);return r.left=this,r.right=t,r.isComplete&&(r.data=r.build(),r.right=void 0),r},e.prototype.build=function(){var t=[],e=this;do{t.push(e.right.data),e=e.left}while(e.left);return t.reverse(),t},e.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))},r.prototype.process=function(t){for(var e=this.states,r=this.wants,n=this.completed,u=0;u<e.length;u++){var i=e[u];if(i.isComplete){if(i.finish(),i.data!==o.fail){for(var s=i.wantedBy,a=s.length;a--;){var l=s[a];this.complete(l,i)}if(i.reference===this.index){var c=i.rule.name;(this.completed[c]=this.completed[c]||[]).push(i)}}}else{if("string"!=typeof(c=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(r[c]){if(r[c].push(i),n.hasOwnProperty(c)){var f=n[c];for(a=0;a<f.length;a++){var h=f[a];this.complete(i,h)}}}else r[c]=[i],this.predict(c)}}},r.prototype.predict=function(t){for(var r=this.grammar.byName[t]||[],n=0;n<r.length;n++){var u=r[n],o=this.wants[t],i=new e(u,0,this.index,o);this.states.push(i)}},r.prototype.complete=function(t,e){var r=t.nextState(e);this.states.push(r)},n.fromCompiled=function(e,r){var u=e.Lexer;e.ParserStart&&(r=e.ParserStart,e=e.ParserRules);var o=new n(e=e.map((function(e){return new t(e.name,e.symbols,e.postprocess)})),r);return o.lexer=u,o},u.prototype.reset=function(t,e){this.buffer=t,this.index=0,this.line=e?e.line:1,this.lastLineBreak=e?-e.col:0},u.prototype.next=function(){if(this.index<this.buffer.length){var t=this.buffer[this.index++];return"\n"===t&&(this.line+=1,this.lastLineBreak=this.index),{value:t}}},u.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},u.prototype.formatError=function(t,e){var r=this.buffer;if("string"==typeof r){var n=r.indexOf("\n",this.index);-1===n&&(n=r.length);var u=r.substring(this.lastLineBreak,n),o=this.index-this.lastLineBreak;return e+=" at line "+this.line+" col "+o+":\n\n",e+="  "+u+"\n",e+="  "+Array(o).join(" ")+"^"}return e+" at index "+(this.index-1)},o.fail={},o.prototype.feed=function(t){var e,n=this.lexer;for(n.reset(t,this.lexerState);e=n.next();){var o=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1,s=new r(this.grammar,i);this.table.push(s);for(var a=void 0!==e.text?e.text:e.value,l=n.constructor===u?e.value:e,c=o.scannable,f=c.length;f--;){var h=c[f],p=h.rule.symbols[h.dot];if(p.test?p.test(l):p.type?p.type===e.type:p.literal===a){var d=h.nextState({data:l,token:e,isToken:!0,reference:i-1});s.states.push(d)}}if(s.process(),0===s.states.length){var y=new Error(this.reportError(e));throw y.offset=this.current,y.token=e,y}this.options.keepHistory&&(o.lexerState=n.save()),this.current++}return o&&(this.lexerState=n.save()),this.results=this.finish(),this},o.prototype.reportError=function(t){var e=[],r=(t.type?t.type+" token: ":"")+JSON.stringify(void 0!==t.value?t.value:t);e.push(this.lexer.formatError(t,"Syntax error")),e.push("Unexpected "+r+". Instead, I was expecting to see one of the following:\n");var n=this.table.length-2;return this.table[n].states.filter((function(t){var e=t.rule.symbols[t.dot];return e&&"string"!=typeof e})).map((function(t){return this.buildFirstStateStack(t,[])||[t]}),this).forEach((function(t){var r=t[0],n=r.rule.symbols[r.dot],u=this.getSymbolDisplay(n);e.push("A "+u+" based on:"),this.displayStateStack(t,e)}),this),e.push(""),e.join("\n")},o.prototype.displayStateStack=function(t,e){for(var r,n=0,u=0;u<t.length;u++){var o=t[u],i=o.rule.toString(o.dot);i===r?n++:(n>0&&e.push("    ⬆ ︎"+n+" more lines identical to this"),n=0,e.push("    "+i)),r=i}},o.prototype.getSymbolDisplay=function(t){var e=typeof t;if("string"===e)return t;if("object"===e&&t.literal)return JSON.stringify(t.literal);if("object"===e&&t instanceof RegExp)return"character matching "+t;if("object"===e&&t.type)return t.type+" token";throw new Error("Unknown symbol type: "+t)},o.prototype.buildFirstStateStack=function(t,e){if(-1!==e.indexOf(t))return null;if(0===t.wantedBy.length)return[t];var r=t.wantedBy[0],n=[t].concat(e),u=this.buildFirstStateStack(r,n);return null===u?null:[t].concat(u)},o.prototype.save=function(){var t=this.table[this.current];return t.lexerState=this.lexerState,t},o.prototype.restore=function(t){var e=t.index;this.current=e,this.table[e]=t,this.table.splice(e+1),this.lexerState=t.lexerState,this.results=this.finish()},o.prototype.rewind=function(t){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[t])},o.prototype.finish=function(){var t=[],e=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(r){r.rule.name===e&&r.dot===r.rule.symbols.length&&0===r.reference&&r.data!==o.fail&&t.push(r)})),t.map((function(t){return t.data}))},{Parser:o,Grammar:n,Rule:t}},t.exports?t.exports=r():e.nearley=r()})),h=c((function(t){var e,r;e=l,r=function(){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,r="boolean"==typeof(new RegExp).sticky;function n(t){return t&&"[object RegExp]"===e.call(t)}function u(t){return t&&"object"==typeof t&&!n(t)&&!Array.isArray(t)}function o(t){return"("+t+")"}function i(t){return t.length?"(?:"+t.map((function(t){return"(?:"+t+")"})).join("|")+")":"(?!)"}function s(t){if("string"==typeof t)return"(?:"+t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(n(t)){if(t.ignoreCase)throw new Error("RegExp /i flag not allowed");if(t.global)throw new Error("RegExp /g flag is implied");if(t.sticky)throw new Error("RegExp /y flag is implied");if(t.multiline)throw new Error("RegExp /m flag is implied");return t.source}throw new Error("Not a pattern: "+t)}function a(e,r){if(u(r)||(r={match:r}),r.include)throw new Error("Matching rules cannot also include states");var o={defaultType:e,lineBreaks:!!r.error||!!r.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var i in r)t.call(r,i)&&(o[i]=r[i]);if("string"==typeof o.type&&e!==o.type)throw new Error("Type transform cannot be a string (type '"+o.type+"' for token '"+e+"')");var s=o.match;return o.match=Array.isArray(s)?s:s?[s]:[],o.match.sort((function(t,e){return n(t)&&n(e)?0:n(e)?-1:n(t)?1:e.length-t.length})),o}function l(t){return Array.isArray(t)?function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];if(n.include)for(var u=[].concat(n.include),o=0;o<u.length;o++)e.push({include:u[o]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));e.push(a(n.type,n))}}return e}(t):function(t){for(var e=Object.getOwnPropertyNames(t),r=[],n=0;n<e.length;n++){var o=e[n],i=t[o],s=[].concat(i);if("include"!==o){var l=[];s.forEach((function(t){u(t)?(l.length&&r.push(a(o,l)),r.push(a(o,t)),l=[]):l.push(t)})),l.length&&r.push(a(o,l))}else for(var c=0;c<s.length;c++)r.push({include:s[c]})}return r}(t)}var c=a("error",{lineBreaks:!0,shouldThrow:!0});function f(t,e){for(var u=null,a=Object.create(null),l=!0,f=null,h=[],p=[],d=0;d<t.length;d++)t[d].fallback&&(l=!1);for(d=0;d<t.length;d++){var y=t[d];if(y.include)throw new Error("Inheritance is not allowed in stateless lexers");if(y.error||y.fallback){if(u)throw!y.fallback==!u.fallback?new Error("Multiple "+(y.fallback?"fallback":"error")+" rules not allowed (for token '"+y.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+y.defaultType+"')");u=y}var v=y.match.slice();if(l)for(;v.length&&"string"==typeof v[0]&&1===v[0].length;)a[v.shift().charCodeAt(0)]=y;if(y.pop||y.push||y.next){if(!e)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+y.defaultType+"')");if(y.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+y.defaultType+"')")}if(0!==v.length){l=!1,h.push(y);for(var g=0;g<v.length;g++){var m=v[g];if(n(m))if(null===f)f=m.unicode;else if(f!==m.unicode&&!1===y.fallback)throw new Error("If one rule is /u then all must be")}var A=i(v.map(s)),b=new RegExp(A);if(b.test(""))throw new Error("RegExp matches empty string: "+b);if(new RegExp("|"+A).exec("").length-1>0)throw new Error("RegExp has capture groups: "+b+"\nUse (?: … ) instead");if(!y.lineBreaks&&b.test("\n"))throw new Error("Rule should declare lineBreaks: "+b);p.push(o(A))}}var F=u&&u.fallback,E=r&&!F?"ym":"gm",x=r||F?"":"|";return!0===f&&(E+="u"),{regexp:new RegExp(i(p)+x,E),groups:h,fast:a,error:u||c}}function h(t,e,r){var n=t&&(t.push||t.next);if(n&&!r[n])throw new Error("Missing state '"+n+"' (in token '"+t.defaultType+"' of state '"+e+"')");if(t&&t.pop&&1!=+t.pop)throw new Error("pop must be 1 (in token '"+t.defaultType+"' of state '"+e+"')")}var p=function(t,e){this.startState=e,this.states=t,this.buffer="",this.stack=[],this.reset()};p.prototype.reset=function(t,e){return this.buffer=t||"",this.index=0,this.line=e?e.line:1,this.col=e?e.col:1,this.queuedToken=e?e.queuedToken:null,this.queuedThrow=e?e.queuedThrow:null,this.setState(e?e.state:this.startState),this.stack=e&&e.stack?e.stack.slice():[],this},p.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},p.prototype.setState=function(t){if(t&&this.state!==t){this.state=t;var e=this.states[t];this.groups=e.groups,this.error=e.error,this.re=e.regexp,this.fast=e.fast}},p.prototype.popState=function(){this.setState(this.stack.pop())},p.prototype.pushState=function(t){this.stack.push(this.state),this.setState(t)};var d=r?function(t,e){return t.exec(e)}:function(t,e){var r=t.exec(e);return 0===r[0].length?null:r};function y(){return this.value}if(p.prototype._getGroup=function(t){for(var e=this.groups.length,r=0;r<e;r++)if(void 0!==t[r+1])return this.groups[r];throw new Error("Cannot find token type for matched text")},p.prototype.next=function(){var t=this.index;if(this.queuedGroup){var e=this._token(this.queuedGroup,this.queuedText,t);return this.queuedGroup=null,this.queuedText="",e}var r=this.buffer;if(t!==r.length){if(i=this.fast[r.charCodeAt(t)])return this._token(i,r.charAt(t),t);var n=this.re;n.lastIndex=t;var u=d(n,r),o=this.error;if(null==u)return this._token(o,r.slice(t,r.length),t);var i=this._getGroup(u),s=u[0];return o.fallback&&u.index!==t?(this.queuedGroup=i,this.queuedText=s,this._token(o,r.slice(t,u.index),t)):this._token(i,s,t)}},p.prototype._token=function(t,e,r){var n=0;if(t.lineBreaks){var u=/\n/g,o=1;if("\n"===e)n=1;else for(;u.exec(e);)n++,o=u.lastIndex}var i={type:"function"==typeof t.type&&t.type(e)||t.defaultType,value:"function"==typeof t.value?t.value(e):e,text:e,toString:y,offset:r,lineBreaks:n,line:this.line,col:this.col},s=e.length;if(this.index+=s,this.line+=n,0!==n?this.col=s-o+1:this.col+=s,t.shouldThrow)throw new Error(this.formatError(i,"invalid syntax"));return t.pop?this.popState():t.push?this.pushState(t.push):t.next&&this.setState(t.next),i},"undefined"!=typeof Symbol&&Symbol.iterator){var v=function(t){this.lexer=t};v.prototype.next=function(){var t=this.lexer.next();return{value:t,done:!t}},v.prototype[Symbol.iterator]=function(){return this},p.prototype[Symbol.iterator]=function(){return new v(this)}}return p.prototype.formatError=function(t,e){if(null==t){var r=this.buffer.slice(this.index);t={text:r,offset:this.index,lineBreaks:-1===r.indexOf("\n")?0:1,line:this.line,col:this.col}}var n=Math.max(0,t.offset-t.col+1),u=t.lineBreaks?t.text.indexOf("\n"):t.text.length,o=this.buffer.substring(n,t.offset+u);return e+=" at line "+t.line+" col "+t.col+":\n\n",e+="  "+o+"\n",e+="  "+Array(t.col).join(" ")+"^"},p.prototype.clone=function(){return new p(this.states,this.state)},p.prototype.has=function(t){return!0},{compile:function(t){var e=f(l(t));return new p({start:e},"start")},states:function(t,e){var r=t.$all?l(t.$all):[];delete t.$all;var n=Object.getOwnPropertyNames(t);e||(e=n[0]);for(var u=Object.create(null),o=0;o<n.length;o++)u[A=n[o]]=l(t[A]).concat(r);for(o=0;o<n.length;o++)for(var i=u[A=n[o]],s=Object.create(null),a=0;a<i.length;a++){var c=i[a];if(c.include){var d=[a,1];if(c.include!==A&&!s[c.include]){s[c.include]=!0;var y=u[c.include];if(!y)throw new Error("Cannot include nonexistent state '"+c.include+"' (in state '"+A+"')");for(var v=0;v<y.length;v++){var g=y[v];-1===i.indexOf(g)&&d.push(g)}}i.splice.apply(i,d),a--}}var m=Object.create(null);for(o=0;o<n.length;o++){var A;m[A=n[o]]=f(u[A],!0)}for(o=0;o<n.length;o++){var b=n[o],F=m[b],E=F.groups;for(a=0;a<E.length;a++)h(E[a],b,m);var x=Object.getOwnPropertyNames(F.fast);for(a=0;a<x.length;a++)h(F.fast[x[a]],b,m)}return new p(m,e)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(t){for(var e=Object.create(null),r=Object.create(null),n=Object.getOwnPropertyNames(t),u=0;u<n.length;u++){var o=n[u],i=t[o];(Array.isArray(i)?i:[i]).forEach((function(t){if((r[t.length]=r[t.length]||[]).push(t),"string"!=typeof t)throw new Error("keyword must be string (in keyword '"+o+"')");e[t]=o}))}function s(t){return JSON.stringify(t)}var a="";for(var l in a+="switch (value.length) {\n",r){var c=r[l];a+="case "+l+":\n",a+="switch (value) {\n",c.forEach((function(t){var r=e[t];a+="case "+s(t)+": return "+s(r)+"\n"})),a+="}\n"}return a+="}\n",Function("value",a)}}},t.exports?t.exports=r():e.moo=r()})).states({main:{tagopen:{match:"[[",push:"key"},EOF:{match:/\$$/u},text:{match:/[\s\S]+?(?=\[\[|\$$)/u,lineBreaks:!0}},key:{keyname:{match:/[a-zA-Z]+\d*/u},sep:{match:"::",next:"intag"},tagclose:{match:"]]",pop:1}},intag:{tagopen:{match:"[[",push:"key"},tagclose:{match:"]]",pop:1},valuestext:{match:/[\s\S]+?(?=\[\[|\]\])/u,lineBreaks:!0}}}),p=function(){function t(t,e,r,n,u,o,i){this.fullKey=t,this.key=e,this.num=r,this.valuesRaw=n,this.values=function(t){return null===t?[]:t.split("::").map((function(t){return t.split("||")}))}(n),this.fullOccur=u,this.occur=o,this.path=i}return t.prototype.shadowValuesRaw=function(e){return new t(this.fullKey,this.key,this.num,e,this.fullOccur,this.occur,this.path)},t.prototype.getDefaultRepresentation=function(){return null===this.valuesRaw?"[["+this.fullKey+"]]":"[["+this.fullKey+"::"+this.valuesRaw+"]]"},t.prototype.getRawRepresentation=function(){var t;return null!==(t=this.valuesRaw)&&void 0!==t?t:""},t.prototype.getFilterKey=function(){return this.key},t}(),d=function(t,e,r,n){this.start=t,this.end=e,this.data=r,this.innerTags=n},y=/^([^0-9]+)([0-9]*)$/u,v=function(){function t(){this.tagCounter=new Map,this.tagPathStack=[],this.tagPathNext=0}return t.prototype.getAndInc=function(t){var e=this.tagCounter.has(t)?this.tagCounter.get(t)+1:0;return this.tagCounter.set(t,e),e},t.prototype.signalTagOpen=function(){this.tagPathStack.push(this.tagPathNext),this.tagPathNext=0},t.prototype.build=function(t,e){var r=t.match(y),n=r[1],u=0===r[2].length?null:Number(r[2]),i=this.getAndInc(t),s=t===n?i:this.getAndInc(n),a=new p(t,n,u,e,i,s,o(this.tagPathStack));return this.tagPathNext=this.tagPathStack.pop()+1,a},t.prototype.reset=function(){this.tagCounter.clear(),this.tagPathStack.length=0,this.tagPathNext=0},t}(),g=function(){function t(){this.fixedLeftOffset=0}return t.prototype.addToLeftOffset=function(t){this.fixedLeftOffset+=t},t.prototype.resetLeftOffset=function(){var t=this.fixedLeftOffset;return this.fixedLeftOffset=0,t},t.prototype.build=function(t,e,r,n){return new d(t+this.fixedLeftOffset,e+this.fixedLeftOffset,r,n)},t}();function m(t){return t[0]}var A,b,F=function(t){return u(t,1)[0].map((function(t){return t.value})).join("")},E=new v,x=new g,w={Lexer:h,ParserRules:[{name:"start",symbols:["content",h.has("EOF")?{type:"EOF"}:EOF],postprocess:function(t){var e=u(t,2),r=u(e[0],2),n=r[0],o=r[1],i=e[1];return x.build(0,i.offset,E.build("base",n),o)}},{name:"content$ebnf$1",symbols:[]},{name:"content$ebnf$1$subexpression$1",symbols:["tag","_"]},{name:"content$ebnf$1",symbols:["content$ebnf$1","content$ebnf$1$subexpression$1"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"content",symbols:["_","content$ebnf$1"],postprocess:function(t){var e=u(t,2),r=e[0],n=e[1];return[r+n.map((function(t){var e=u(t,2),r=e[0],n=e[1];return m(r).join("")+n})).join(""),n.map(m).map((function(t){return t[1]}))]}},{name:"tag",symbols:["tagopen","inner",h.has("tagclose")?{type:"tagclose"}:tagclose],postprocess:function(t){var e=u(t,3),r=e[0],n=u(e[1],3),o=n[0],i=n[1],s=n[2],a=e[2],l="string"==typeof i;return[["[[",l?o+"::"+i:o,"]]"],x.build(r,a.offset+"]]".length,E.build(o,l?i:null),s.map((function(t){return t[1]})))]}},{name:"tagopen",symbols:[h.has("tagopen")?{type:"tagopen"}:tagopen],postprocess:function(t){var e=u(t,1)[0];return E.signalTagOpen(),e.offset+e.value.length-"[[".length}},{name:"inner$ebnf$1$subexpression$1$ebnf$1",symbols:[]},{name:"inner$ebnf$1$subexpression$1$ebnf$1$subexpression$1",symbols:["tag","_values"]},{name:"inner$ebnf$1$subexpression$1$ebnf$1",symbols:["inner$ebnf$1$subexpression$1$ebnf$1","inner$ebnf$1$subexpression$1$ebnf$1$subexpression$1"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"inner$ebnf$1$subexpression$1",symbols:[h.has("sep")?{type:"sep"}:sep,"_values","inner$ebnf$1$subexpression$1$ebnf$1"]},{name:"inner$ebnf$1",symbols:["inner$ebnf$1$subexpression$1"],postprocess:m},{name:"inner$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"inner",symbols:[h.has("keyname")?{type:"keyname"}:keyname,"inner$ebnf$1"],postprocess:function(t){var e=u(t,2),r=e[0],n=e[1];return[r.value,n?n[1]+n[2].map((function(t){var e=u(t,2),r=e[0],n=e[1];return m(r).join("")+n})).join(""):null,n?n[2].map(m):[]]}},{name:"_values$ebnf$1",symbols:[]},{name:"_values$ebnf$1",symbols:["_values$ebnf$1",h.has("valuestext")?{type:"valuestext"}:valuestext],postprocess:function(t){return t[0].concat([t[1]])}},{name:"_values",symbols:["_values$ebnf$1"],postprocess:F},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1",h.has("text")?{type:"text"}:text],postprocess:function(t){return t[0].concat([t[1]])}},{name:"_",symbols:["_$ebnf$1"],postprocess:F}],ParserStart:"start"},B=function(t){return x.build(0,t.length,E.build("base",t),[])},D=function(t){var e=new f.Parser(f.Grammar.fromCompiled(w)),r=null;try{r=e.feed(t+"$").results}catch(e){r=[B(t)]}return r.length,r[0]},C=function(t,e){switch(e){case 1:return function(t){var e=D(t);return E.reset(),e}(t[0]);case 2:return function(t){var e,r,u=[];try{for(var o=n(t),i=o.next();!i.done;i=o.next()){var s=i.value;E.signalTagOpen();var a=D(s);u.push(a),x.addToLeftOffset(s.length)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}var l=x.resetLeftOffset(),c=x.build(0,l,E.build("base",t.join("")),u);return E.reset(),c}(t);case 3:throw new Error("baseDepth with value "+e+" is not supported.")}},k=function(t,e){var r,o,i=[];try{for(var s=n(e),a=s.next();!a.done;a=s.next()){var l=u(a.value,2),c=l[0],f=l[1];i.push(t.slice(c,f))}}catch(t){r={error:t}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return i},S=function(t,e,r){for(var n=!1,o=0;o<50&&!n;o++){var i=C(t,r),s={iteration:{index:o},template:new a(i),baseDepth:r},l=u($(t.join(""),i,r,e.filterProcessor(s)),4),c=l[0],f=l[2],h=l[3];t=k(c,h),n=f,e.executeDeferred(s)}return t},$=function(t,e,r,n){var o=[],a=function(t,e){var l=u(t,3),c=l[0],f=l[1],h=l[2];f.push(f[f.length-1]);var p=u(e.innerTags.reduce(a,[c,f,!0]),3),d=p[0],y=p[1],v=p[2];y.push(y.pop()-y[y.length-1]);var g=y.pop(),m=y.pop(),A=u(function(t,e,r,n){return[t+r,e+r+n]}(e.start,e.end,m,g),2),b=A[0],F=A[1],E=null,x=e.data.path.length+1;x<=r?(E=d.slice(b,F),x===r&&o.push([b,F])):E=null===e.data.valuesRaw?null:d.slice(b+("[[".length+e.data.fullKey.length+"::".length),F-"]]".length);var w=e.data.shadowValuesRaw(E),B=n(w,{ready:v,depth:x-r}),D=u(null===B.result?[d,0]:function(t,e,r,n){return[i(t,e,r,n),s(e,r,n)]}(d,B.result,b,F),2),C=D[0],k=g+m+D[1];return y.push(k),[C,y,h&&B.ready]},l=u(a([t,[0,0],!0],e),3);return[l[0],l[1],l[2],o]},O=function(){function t(t){this.storage=t}return t.prototype.set=function(t,e){this.storage.set(t,e)},t.prototype.has=function(t){return this.storage.has(t)},t.prototype.get=function(t,e){return void 0===e&&(e=null),this.has(t)?this.storage.get(t):e},t.prototype.fold=function(t,e,r){var n=e(this.get(t,r));return this.set(t,n),n},t.prototype.over=function(t,e,r){this.has(t)?e(this.get(t,r)):(e(r),this.set(t,r))},t.prototype.delete=function(t){this.storage.delete(t)},t.prototype.clear=function(){this.storage.clear()},t}(),_=function(t){return{result:t,ready:!0}},T=function(t,e){return{result:t,ready:e}},N=function(t){return function(e,r){var n,u=t(e,r);switch(typeof u){case"string":return _(u);case"object":return{result:u.result,ready:null===(n=u.ready)||void 0===n||n};default:return{result:null,ready:!1}}}},I=function(t,e){return T(t.getRawRepresentation(),e.round.ready)},z=function(t){return _(t.getRawRepresentation())},j=function(t,e){return T(t.getDefaultRepresentation(),e.round.ready)},M=function(){function t(){this.filters=new Map}return t.prototype.register=function(t,e){this.filters.set(t,e)},t.prototype.has=function(t){return"raw"===t||"base"===t||this.filters.has(t)},t.prototype.get=function(t){return"base"===t?I:"raw"===t?z:this.filters.has(t)?N(this.filters.get(t)):null},t.prototype.getOrDefault=function(t){var e=this.get(t);return e||j},t.prototype.unregisterFilter=function(t){this.filters.delete(t)},t.prototype.clearFilters=function(){this.filters.clear()},t.prototype.execute=function(t,e){return N(this.getOrDefault(t.getFilterKey()))(t,e)},t}(),P=function(t){return(t+1>>>1)-1},R=function(t){return 1+(t<<1)},L=function(t){return t+1<<1},K=function(){function t(t){this._heap=[],this._comparator=t}return t.prototype.greater=function(t,e){return this._comparator(this._heap[t],this._heap[e])},t.prototype.swap=function(t,e){var r;r=u([this._heap[e],this._heap[t]],2),this._heap[t]=r[0],this._heap[e]=r[1]},t.prototype.siftUp=function(){for(var t=this.size()-1;t>0&&this.greater(t,P(t));)this.swap(t,P(t)),t=P(t)},t.prototype.siftDown=function(){for(var t=0;R(t)<this.size()&&this.greater(R(t),t)||L(t)<this.size()&&this.greater(L(t),t);){var e=L(t)<this.size()&&this.greater(L(t),R(t))?L(t):R(t);this.swap(t,e),t=e}},t.prototype.size=function(){return this._heap.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.peek=function(){return this._heap[0]},t.prototype.push=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.forEach((function(e){t._heap.push(e),t.siftUp()})),this.size()},t.prototype.pop=function(){var t=this.peek(),e=this.size()-1;return e>0&&this.swap(0,e),this._heap.pop(),this.siftDown(),t},t.prototype.generate=function(){var t;return r(this,(function(e){switch(e.label){case 0:t=this.pop(),e.label=1;case 1:return t?[4,t]:[3,3];case 2:return e.sent(),t=this.pop(),[3,1];case 3:return[2,null]}}))},t}(),q={priority:0,persistent:!1},H=function(t,e){return t.priority>e.priority},G=function(){function t(){this._deferred=new Map,this._blocked=new Set}return t.prototype.register=function(t,e,r){var n=r.priority,u=void 0===n?0:n,o=r.persistent,i=void 0!==o&&o;this._deferred.set(t,{keyword:t,procedure:e,priority:u,persistent:i})},t.prototype.registerIfNotExists=function(t,e,r){void 0===r&&(r=q),this.isRegistered(t)||this.register(t,e,r)},t.prototype.unregister=function(t){this._deferred.delete(t)},t.prototype.isRegistered=function(t){return this._deferred.has(t)},t.prototype.block=function(t){this._blocked.add(t)},t.prototype.unblock=function(t){this._blocked.delete(t)},t.prototype.isBlocked=function(t){return this._blocked.has(t)},t.prototype.clear=function(){this._deferred.clear(),this._blocked.clear()},t.prototype.executeEach=function(t){var e,r,u=new K(H);u.push.apply(u,o(this._deferred.values()));try{for(var i=n(u.generate()),s=i.next();!s.done;s=i.next()){var a=s.value;this.isBlocked(a.keyword)||a.procedure(a,t),a.persistent||this.unregister(a.keyword)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}this._blocked.clear()},t}(),J=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=new Map),this.preset=t,this.filters=new M,this.deferred=new G,this.aftermath=new G,this.cache=new O(new Map),this.memory=new O(e),globalThis.closetEnvironment||(globalThis.closetEnvironment=new O(new Map)),this.environment=globalThis.closetEnvironment}return t.prototype.getInternals=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),{filters:this.filters,preset:this.preset,iteration:t,round:e,cache:this.cache,memory:this.memory,environment:this.environment,deferred:this.deferred,aftermath:this.aftermath}},t.prototype.filterProcessor=function(t){var e=this;return function(r,n){return e.filters.execute(r,e.getInternals(t,n))}},t.prototype.executeDeferred=function(t){this.deferred.executeEach(this.getInternals(t))},t.prototype.executeAftermath=function(){this.aftermath.executeEach(this.getInternals())},t.prototype.clearMemory=function(){this.memory.clear(),this.aftermath.clear()},t.prototype.reset=function(){this.cache.clear(),this.deferred.clear()},t.prototype.addRecipe=function(t){t(this.filters)},t}(),U=function(t){return t},Z=/^([a-zA-Z]+)([0-9]*)$/u,V="A-Za-z\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16F1-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FD5\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC",X="0-9\\xB2\\xB3\\xB9\\xBC-\\xBE\\u0660-\\u0669\\u06F0-\\u06F9\\u07C0-\\u07C9\\u0966-\\u096F\\u09E6-\\u09EF\\u09F4-\\u09F9\\u0A66-\\u0A6F\\u0AE6-\\u0AEF\\u0B66-\\u0B6F\\u0B72-\\u0B77\\u0BE6-\\u0BF2\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0CE6-\\u0CEF\\u0D58-\\u0D5E\\u0D66-\\u0D78\\u0DE6-\\u0DEF\\u0E50-\\u0E59\\u0ED0-\\u0ED9\\u0F20-\\u0F33\\u1040-\\u1049\\u1090-\\u1099\\u1369-\\u137C\\u16EE-\\u16F0\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1946-\\u194F\\u19D0-\\u19DA\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1B50-\\u1B59\\u1BB0-\\u1BB9\\u1C40-\\u1C49\\u1C50-\\u1C59\\u2070\\u2074-\\u2079\\u2080-\\u2089\\u2150-\\u2182\\u2185-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2CFD\\u3007\\u3021-\\u3029\\u3038-\\u303A\\u3192-\\u3195\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\uA620-\\uA629\\uA6E6-\\uA6EF\\uA830-\\uA835\\uA8D0-\\uA8D9\\uA900-\\uA909\\uA9D0-\\uA9D9\\uA9F0-\\uA9F9\\uAA50-\\uAA59\\uABF0-\\uABF9\\uFF10-\\uFF19",Q=new RegExp("["+V+"]","gu"),W=new RegExp("["+X+"]","gu"),Y=new RegExp("["+V+X+"]","gu"),tt=function(t,e){var r,u,o,i,s=[];try{for(var a=n(e),l=a.next();!l.done;l=a.next()){var c=t[d=l.value];c&&s.push(c)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(u=a.return)&&u.call(a)}finally{if(r)throw r.error}}if(e.length<t.length){var f=Array.from(new Array(t.length-e.length),(function(t,r){return r+e.length}));try{for(var h=n(f),p=h.next();!p.done;p=h.next()){var d=p.value;s.push(t[d])}}catch(t){o={error:t}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}}return s},et=function(t,e){if(t.length>=e)return t;var r=Array.from(new Array(e-t.length),(function(e,r){return r+t.length})),n=o(t);return r.forEach((function(t){return n.splice(Math.floor(Math.random()*(n.length+1)),0,t)})),n},rt=function(t,e){return e.includes(",")?e.split(","):t[0]},nt=function(){function t(t){var e=void 0===t?{}:t,r=e.separator,n=void 0===r?", ":r,u=e.mapper,o=void 0===u?U:u,i=e.postprocess,s=void 0===i?U:i;this.separator=n,this.mapper=o,this.postprocess=s}return t.prototype.toFullStylizer=function(t){var e=void 0===t?{}:t,r=e.separator,n=void 0===r?this.separator:r,u=e.separatorOuter,o=void 0===u?"; ":u,i=e.mapper,s=void 0===i?this.mapper:i,a=e.mapperOuter,l=void 0===a?U:a,c=e.postprocess,f=void 0===c?this.postprocess:c;return new ut({separator:n,mapper:s,separatorOuter:o,mapperOuter:l,postprocess:f})},t.prototype.toStylizer=function(e){var r=void 0===e?{}:e,n=r.separator,u=void 0===n?this.separator:n,o=r.mapper,i=void 0===o?this.mapper:o,s=r.postprocess;return new t({separator:u,mapper:i,postprocess:void 0===s?this.postprocess:s})},t.prototype.stylize=function(t,e){var r=this;return void 0===e&&(e=[]),this.postprocess(t.flatMap((function(t,n){return r.mapper.apply(r,o([t,n],e.map((function(t){return t[n]}))))})).join(this.separator))},t}(),ut=function(t){function r(e){var r=void 0===e?{}:e,n=r.separator,u=void 0===n?", ":n,o=r.mapper,i=void 0===o?U:o,s=r.postprocess,a=void 0===s?U:s,l=r.separatorOuter,c=void 0===l?"; ":l,f=r.mapperOuter,h=void 0===f?U:f,p=r.postprocessOuter,d=void 0===p?U:p,y=t.call(this,{separator:u,mapper:i,postprocess:a})||this;return y.separatorOuter=c,y.mapperOuter=h,y.postprocessOuter=d,y}return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}(r,t),r.prototype.stylizeFull=function(t,e,r){var n=this;void 0===e&&(e=[]),void 0===r&&(r=[]);var u=t.map((function(t,r){return n.stylize(t,e[r])}));return this.postprocessOuter(u.flatMap((function(t,e){return n.mapperOuter(t,e,r.map((function(t){return t[e]})))})).join(this.separatorOuter))},r}(nt),ot=new ut({separator:"||",separatorOuter:"::"}),it=function(t,e,r,n){var u=n.cache,o=n.memory,i=n.deferred,s=n.round,a=t+":apply",l=e+":waitingSet",c=e+":shuffle";if(u.get(a,!1)){if(u.get(l,new Set).size>0)return;for(var f=[],h=u.get(c,[]),p=0;p<r.length;p++)f.push(h.shift());return f}s.ready?(u.fold(c,(function(t){return t.concat(r)}),[]),i.registerIfNotExists(a,(function(){u.set(a,!0),u.over(l,(function(e){return e.delete(t)}),new Set)}),{priority:15}),i.registerIfNotExists(c,(function(){u.get(l,new Set).size>0||u.fold(c,(function(t){var e=o.fold(c,(function(t){return et(t,u.get(c,[]).length)}),[]);return tt(t,e)}),[])}))):u.over(l,(function(e){return e.add(t)}),new Set)},st=function(t,e,r,n,u,o,i){return function(s){s.register(t,(function(t,s){var a=e(t,s),l=r(t,s);return a&&l?n(t,s):a?u(t,s):l?o(t,s):i(t,s)}))}},at=function(t,e){return"back"===e.preset.side},lt=function(t,e){var r=t.num,n=e.preset;switch(r){case null:return!1;case 0:return!0;default:if(!n.card)return!1;var u=n.card.match(/[0-9]*$/);return Number(u)===r}},ct=function(){return"​[...]​"},ft=(A=ot,b=function(t){return t[1]},function(t,e){var r=t.values;return"​"+A.stylize(b(r))+"​"}),ht=new nt({postprocess:function(t){return'<span style="color: cornflowerblue;">'+t+"</span>"}}),pt=function(){return function(t){var e=t.values;return ot.stylize(e[0])}},dt=function(t,e){return function(r){var n=void 0===r?{}:r,u=n.tagname,o=void 0===u?"c":u,i=n.switcherKeyword,s=void 0===i?"switch":i,a=n.activateKeyword,l=void 0===a?"activate":a,c=n.activeStylizer,f=void 0===c?ht:c,h=n.activeEllipser,p=void 0===h?ft:h,d=n.inactiveEllipser,y=void 0===d?ct:d;return function(r){var n=o+":internal",u=!1;st(n,at,(function(t,e){return lt(t,e)||u}),(function(t){return f.stylize(t.values[0])}),t(y),(function(t,e){return f.stylize([p(t,e)])}),e(y))(r);r.register(o,(function(t,e){var r=e.cache.get(o+":"+s,{get:function(t,e,r){return n}}).get(t.key,t.num,t.fullOccur);return u=e.cache.get(o+":"+l,{get:function(t,e,r){return!1}}).get(t.key,t.num,t.fullOccur),e.filters.get(r)(t,e)}))}}},yt=dt(pt,pt),vt=dt(U,U),gt=dt(U,pt),mt=new nt({separator:", ",mapper:function(t){return'<span style="color: orange;">'+t+"</span>"},postprocess:function(t){return"( "+t+" )"}}),At=mt.toStylizer({mapper:function(t,e,r){return'<span style="color: '+(0===r?"lime":"red")+';">'+t+"</span>"}}),bt=function(t,e){var r=it(t.fullKey+":"+t.fullOccur,t.fullKey+":"+t.fullOccur,t.values[0],e);if(r)return(new nt).stylize(r)},Ft=function(t){return function(e,r){var n=e.values,u=e.fullKey,o=e.fullOccur,i=n.flatMap((function(t,e){return t.map((function(t){return[t,e]}))})),s=it(u+":"+o,u+":"+o,i,r);if(s)return t.stylize(s.map((function(t){return t[0]})),[s.map((function(t){return t[1]}))])}},Et=function(t,e){return function(r){var n=r.tagname,u=r.switcherKeyword,o=void 0===u?"switch":u,i=r.activateKeyword,s=void 0===i?"activate":i,a=r.backStylizer,l=void 0===a?At:a,c=r.frontStylizer,f=void 0===c?mt:c,h=r.ellipser,p=void 0===h?ct:h,d=r.contexter,y=void 0===d?bt:d;return function(r){var u=n+":internal",i=!1;st(u,at,(function(t,e){return lt(t,e)||i}),Ft(l),t(p,y),Ft(f),e(p,y))(r);r.register(n,(function(t,e){var r=e.cache.get(n+":"+o,{get:function(t,e,r){return u}}).get(t.key,t.num,t.fullOccur);return i=e.cache.get(n+":"+s,{get:function(t,e,r){return!1}}).get(t.key,t.num,t.fullOccur),e.filters.get(r)(t,e)}))}}},xt=function(t){return t},wt=function(t,e){return e},Bt=Et(wt,wt),Dt=Et(xt,xt),Ct=Et(wt,xt),kt=/%(\d*)/u,St=function(){function t(){this.theMap=new Map}return t.prototype.getKey=function(t,e,r){return t+":"+("number"==typeof e?String(e):"all")+":"+("number"==typeof r?String(r):"all")},t.prototype.on=function(t,e,r){var n=this.getKey(t,e,r);this.theMap.set(n,!0)},t.prototype.off=function(t,e,r){var n=this.getKey(t,e,r);this.theMap.set(n,!1)},t.prototype.toggle=function(t,e,r){var n=this.getKey(t,e,r);this.theMap.has(n)?this.theMap.set(n,!this.theMap.get(n)):this.theMap.set(n,!0)},t.prototype.get=function(t,e,r){var n=this.getKey(t,e,r);if(this.theMap.has(n))return this.theMap.get(n);var u=this.getKey(t,e,null);if(this.theMap.has(u))return this.theMap.get(u);var o=this.getKey(t,null,null);return!!this.theMap.has(o)&&this.theMap.get(o)},t}(),$t=function(t,e){return function(r,n){var o=r.values,i=r.valuesRaw,s=n.cache;return rt(o,i).forEach((function(r){var n=u(r.split(":"),2),o=n[0],i=n[1],a=u(o.match(Z),3),l=a[1],c=a[2],f=i?Number(i):null,h=0===c.length?null:Number(c);s.over(l+":"+t,e(l,h,f),new St)})),""}},Ot=function(t){return[t.tagname]},_t=function(t,e){return t.tagname=e[0]},Tt=function(t){return function(e,r,u){var o=void 0===u?{}:u,i=o.wrapId,s=void 0===i?"wrapped":i,a=o.getTagnames,l=void 0===a?Ot:a,c=o.setTagnames,f=void 0===c?_t:c,h=o.getApiKeyword,p=void 0===h?U:h;return function(u){return void 0===u&&(u={}),function(o){var i,a,c=l(u),h=new Map,d=c.map((function(t){var e=t+":"+s+":internal";return h.set(t,e),e}));f(u,d),r(u)(o);var y=function(r,n){var u=h.get(r.key),o=p(u);return t(n).registerIfNotExists(o,e),n.filters.get(u)(r,n)};try{for(var v=n(c),g=v.next();!g.done;g=v.next()){var m=g.value;o.register(m,y)}}catch(t){i={error:t}}finally{try{g&&!g.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}}}}},Nt={shuffling:function(t){var e=t.tagname,r=t.stylizer,n=void 0===r?new nt:r;return function(t){t.register(e,(function(t,e){var r=t.fullKey,u=t.key,o=t.num,i=t.fullOccur,s=t.values,a=it(r+":"+i,o?r:u+":"+i,s[0],e);if(a)return n.stylize(a)}))}},ordering:function(t){var e=t.tagname,r=t.shuffleTagname;return function(t){t.register(e,(function(t,e){var u,o=t.key,i=t.fullOccur,s=t.values,a=t.valuesRaw,l=e.deferred,c=e.cache,f=o+":ord:occupied",h=(u=rt(s,a),u.map((function(t){return Number(t)})).filter((function(t){return!isNaN(t)}))).filter((function(t){return!c.get(f,[]).includes(t)}));c.fold(f,(function(t){return t.concat(h)}),[]);var p=new Set(h.map((function(t){return""+r+t}))),d=o+":"+i+":ord";return l.register(d,(function(){var t,e,r=[],u=function(t){if(l.block(t+":mix"),0!==c.get(t+":waitingSet",new Set).size)return"continue";var e=c.get(t,[]),n=et(c.get(d,[]),e.length);c.fold(t,(function(t){return tt(t,n)}),[]),r.push(t),c.set(d,n)};try{for(var o=n(p),i=o.next();!i.done;i=o.next()){u(i.value)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}r.forEach((function(t){return p.delete(t)})),0===p.size&&l.unregister(d)}),{priority:35,persistent:!0}),""}))}},clozeShow:yt,clozeHide:vt,clozeReveal:gt,multipleChoiceShow:Bt,multipleChoiceHide:Dt,multipleChoiceReveal:Ct,stylizing:function(t){var e=t.tagname,r=t.stylizer,n=void 0===r?new ut:r;return function(t){t.register(e,(function(t){var e=t.values;return n.stylizeFull(e)}))}},activate:function(t){var e=t.tagname,r=t.activateId,n=void 0===r?"activate":r;return function(t){t.register(e,$t(n,(function(t,e,r){return function(n){n.on(t,e,r)}})))}},deactivate:function(t){var e=t.tagname,r=t.activateId,n=void 0===r?"activate":r;return function(t){t.register(e,$t(n,(function(t,e,r){return function(n){n.off(t,e,r)}})))}},toggle:function(t){var e=t.tagname,r=t.activateId,n=void 0===r?"activate":r;return function(t){t.register(e,$t(n,(function(t,e,r){return function(n){n.toggle(t,e,r)}})))}},debug:function(){return function(t){t.register("tagpath",(function(t){return t.path.join(":")})),t.register("never",(function(){})),t.register("empty",(function(){return""})),t.register("key",(function(t){return t.key})),t.register("memorytest",(function(t,e){var r=e.memory;return String(r.fold("base:memorytest",(function(t){return++t}),0))}))}},meta:function(){return function(t){t.register("def",(function(t,e){var r=t.values,n=e.filters,u=r;return n.register(r[0][0],(function(t){var e=t.values;return{result:"[["+u.slice(1).map((function(t){return t.map((function(t){var r=t.match(kt);if(r){var n=0===r[1].length?0:Number(r[1]);return e[n]?e[n].join("||"):""}return t})).join("||")})).join("::")+"]]",ready:!1}})),{result:"",ready:!1}}))}}},It={deferred:Tt((function(t){return t.deferred})),aftermath:Tt((function(t){return t.aftermath}))},zt=function(t,e,r){return t<0?r+t+1:e+t},jt=function(t){if("string"==typeof t)return t;switch(t.nodeType){case Node.TEXT_NODE:return t.textContent;case Node.ELEMENT_NODE:return t.innerHTML;case Lt.CHILD_NODE_SPAN:return t.spanAsStrings().join("");default:return""}},Mt=function(t,e){if("string"!=typeof t)switch(t.nodeType){case Node.TEXT_NODE:var r=t,n=document.createElement("div");r.parentElement.insertBefore(n,r),r.parentElement.removeChild(r),n.outerHTML=e;break;case Node.ELEMENT_NODE:t.innerHTML=e;break;case Lt.CHILD_NODE_SPAN:t.replaceSpan(e)}},Pt={type:"index",value:0},Rt={type:"index",value:-1},Lt=function(){function t(e,r,n){var u,o,i,s;void 0===r&&(r=Pt),void 0===n&&(n=Rt),this.nodeType=t.CHILD_NODE_SPAN,this.parentElement=e,this.childNodes=Array.from(this.parentElement.childNodes),this.max=e.childNodes.length-1;var a=this.getFromMethod(r.type),l=this.getToMethod(n.type);this._fromIndex=a.call(this,r.value,null!==(u=r.startAtIndex)&&void 0!==u?u:0,null!==(o=r.exclusive)&&void 0!==o&&o),this._toIndex=l.call(this,n.value,Math.max(null!==(i=n.startAtIndex)&&void 0!==i?i:0,this.from),null!==(s=n.exclusive)&&void 0!==s&&s)}return Object.defineProperty(t.prototype,"from",{get:function(){return this._fromIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"to",{get:function(){return this._toIndex},enumerable:!1,configurable:!0}),t.prototype.getFromMethod=function(t){return"index"===t?this.fromIndex:"node"===t?this.fromNode:this.fromPredicate},t.prototype.getToMethod=function(t){return"index"===t?this.toIndex:"node"===t?this.toNode:this.toPredicate},t.prototype.fromSafe=function(t,e){return t<e||t>this.max?this.max:t},t.prototype.fromIndex=function(t,e,r){var n=zt(t,e,this.max)+(r?1:0);return this.fromSafe(n,e)},t.prototype.fromPredicate=function(t,e,r){var n=this.childNodes.slice(e).findIndex(t)+e+(r?1:0);return this.fromSafe(n,e)},t.prototype.fromNode=function(t,e,r){var n=this.childNodes.slice(e).findIndex((function(e){return e===t}))+e+(r?1:0);return this.fromSafe(n,e)},t.prototype.toSafe=function(t,e){return t<e||t>this.max?0:t},t.prototype.toIndex=function(t,e,r){var n=zt(t,e,this.max)-(r?1:0);return this.toSafe(n,e)},t.prototype.toPredicate=function(t,e,r){var n=this.childNodes.slice(e).findIndex(t)+e-(r?1:0);return this.toSafe(n,e)},t.prototype.toNode=function(t,e,r){var n=this.childNodes.slice(e).findIndex((function(e){return e===t}))+e-(r?1:0);return this.toSafe(n,e)},Object.defineProperty(t.prototype,"valid",{get:function(){return this._fromIndex<=this._toIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.max(0,this._toIndex-this._fromIndex+1)},enumerable:!1,configurable:!0}),t.prototype.span=function(){return this.valid?this.childNodes.slice(this._fromIndex,this._toIndex):[]},t.prototype.spanAsStrings=function(){return this.span().map(jt)},t.prototype.replaceSpan=function(t){var e,r;if(this.valid){var u=document.createElement("div"),o=this.parentElement.childNodes.length;this.parentElement.insertBefore(u,this.parentElement.childNodes[this._fromIndex]);try{for(var i=n(this.span()),s=i.next();!s.done;s=i.next()){var a=s.value;this.parentElement.removeChild(a)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}u.outerHTML=t,this.childNodes=Array.from(this.parentElement.childNodes),this.max=this.childNodes.length,this._toIndex=this._toIndex+(this.max-o)}},t.CHILD_NODE_SPAN=3353,t}(),Kt=function(t,e){return void 0===e&&(e=0),[{type:"predicate",value:t.value,startAtIndex:e,exclusive:!1},{type:"predicate",value:function(e){return!t.value(e)},startAtIndex:e,exclusive:!0}]},qt=function(t,e){for(var r=[],n=new(Lt.bind.apply(Lt,o([void 0,t],Kt(e))));n.valid;)r.push(n),n=new(Lt.bind.apply(Lt,o([void 0,t],Kt(e,n.to+1))));return r},Ht=Object.freeze({__proto__:null,ChildNodeSpan:Lt,interspliceChildNodes:qt,renderTemplateFromNode:function(t,e,r){void 0===r&&(r=null);var n=S([jt(t)],e,1);r?r(n[0]):Mt(t,n[0]),e.executeAftermath()},renderTemplateFromNodes:function(t,e,r){void 0===r&&(r=null);var n=S(t.map(jt),e,2);r?r(n):t.forEach((function(t,e){return Mt(t,n[e])})),e.executeAftermath()},appendStyleScript:function(t){var e=document.createElement("style");e.type="text/css",e.innerText=t,globalThis.document.head.appendChild(e)},zeroWidthSpaceEntity:"&#8203;",wordBreakTag:"<wbr />"}),Gt={tagsFull:"{{Tags}}",card:"{{Card}}",tags:"{{Tags}}".split(" ")},Jt=Object.freeze({__proto__:null,preset:Gt,memorySwitch:function(t){var e=null;return{switchTo:function(r){t.getItem(r)||t.setItem(r,new Map),e=t.getItem(r)},fallback:function(){e=new Map},has:function(t){return e.has(t)},get:function(t){return e.get(t)},set:function(t,r){return e.set(t,r)},delete:function(t){return e.delete(t)},clear:function(){return e.clear()}}},getQaChildNodes:function(){if(!globalThis.document)return null;var t=globalThis.document.getElementById("qa");return t?qt(t,{type:"predicate",value:function(t){return"STYLE"!==t.tagName&&"SCRIPT"!==t.tagName&&"anki-am"!==t.id}}):null}});return t.FilterManager=J,t.FullStylizer=ut,t.Stylizer=nt,t.anki=Jt,t.browser=Ht,t.keyPattern=Z,t.recipes=Nt,t.renderDisjointTemplate=function(t,e,r){var n=S(t,e,2);return r&&r(n),e.executeAftermath(),e.reset(),n},t.renderTemplate=function(t,e,r){void 0===r&&(r=null);var n=S([t],e,1)[0];return r&&r(n),e.executeAftermath(),e.reset(),n},t.unicodeAlphanumericPattern=Y,t.unicodeLetterPattern=Q,t.unicodeNumberPattern=W,t.wrappers=It,t}({});
